Would normally try and create some integration tests here. 
I would normally use the package 'patrol' to do this as it allows for platform interaction such as permissions and the code is much shorter